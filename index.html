<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Oakberry - Ventas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes slideInFromLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .animate-slide-in {
            animation: slideInFromLeft 0.6s ease-out forwards;
        }
        
        .animate-slide-bottom {
            animation: slideInFromBottom 0.6s ease-out forwards;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3);
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        .card-glow {
            box-shadow: 0 0 30px rgba(124, 58, 237, 0.2);
        }
        
        .number-counter {
            font-variant-numeric: tabular-nums;
        }
        
        .btn-hover {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-hover::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-hover:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .table-row {
            transition: all 0.3s ease;
        }
        
        .table-row:hover {
            transform: scale(1.01);
            z-index: 10;
        }

        @media (max-width: 768px) {
            .hover-lift:hover {
                transform: translateY(-4px) scale(1.01);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-white to-purple-50 min-h-screen">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-700 via-purple-600 to-purple-800 text-white shadow-2xl overflow-hidden relative">
        <div class="absolute inset-0 shimmer opacity-20"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 relative z-10 animate-fade-in">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="animate-slide-in text-center sm:text-left">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black tracking-tight mb-2">OAKBERRY</h1>
                    <p class="text-purple-200 text-base sm:text-lg lg:text-xl font-light">Dashboard de Ventas ¬∑ En tiempo real</p>
                </div>
                <div class="flex items-center gap-3 sm:gap-4 animate-slide-in" style="animation-delay: 0.2s; opacity: 0;">
                    <div class="bg-white/20 backdrop-blur-lg px-4 sm:px-6 py-2 sm:py-3 rounded-xl border border-white/30 hover:bg-white/30 transition-all duration-300">
                        <p class="text-xs text-purple-200 font-semibold uppercase tracking-wide">√öltima actualizaci√≥n</p>
                        <p class="text-base sm:text-lg font-bold" id="lastUpdate">Cargando...</p>
                    </div>
                    <div class="w-3 h-3 rounded-full bg-green-400 animate-pulse shadow-lg shadow-green-400/50"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
        <!-- Selector de Fecha -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl mb-6 sm:mb-8 border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 animate-slide-bottom" style="animation-delay: 0.1s; opacity: 0;">
            <div class="flex items-center gap-3 mb-4 sm:mb-6">
                <svg class="w-6 h-6 sm:w-7 sm:h-7 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Seleccionar Fecha</h3>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6">
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">D√≠a</label>
                    <input type="number" min="1" max="31" value="1" id="inputDay" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                </div>
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">Mes</label>
                    <select id="inputMonth" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                        <option>Enero</option>
                        <option>Febrero</option>
                        <option>Marzo</option>
                        <option>Abril</option>
                        <option>Mayo</option>
                        <option>Junio</option>
                        <option>Julio</option>
                        <option>Agosto</option>
                        <option>Septiembre</option>
                        <option selected>Octubre</option>
                        <option>Noviembre</option>
                        <option>Diciembre</option>
                    </select>
                </div>
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">A√±o</label>
                    <input type="number" value="2025" id="inputYear" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                </div>
            </div>
        </div>

        <!-- Vista General -->
        <div id="viewOverview" class="space-y-6 sm:space-y-8">
            <!-- KPI Principal: Ventas del D√≠a -->
            <div class="kpi-card bg-gradient-to-br from-purple-600 to-purple-800 text-white p-6 sm:p-8 rounded-2xl shadow-2xl hover-lift card-glow animate-slide-bottom" style="animation-delay: 0.2s; opacity: 0;">
                <div class="flex items-center justify-between mb-4 sm:mb-6">
                    <div class="p-3 sm:p-4 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8 sm:w-10 sm:h-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-purple-200 text-xs sm:text-sm font-semibold uppercase tracking-wider mb-2">Ventas del D√≠a</p>
                <p class="text-3xl sm:text-4xl lg:text-5xl font-black mb-3 sm:mb-4 number-counter" id="totalVentas">‚Ç°0</p>
                <div class="pt-3 sm:pt-4 border-t border-white/20">
                    <p class="text-xs sm:text-sm text-purple-200">Total de tiendas activas: <span id="numTiendas" class="font-bold">0</span></p>
                </div>
            </div>

            <!-- Distribuci√≥n por Canal de Venta -->
            <div class="bg-white p-8 rounded-2xl shadow-2xl border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 animate-slide-bottom" style="animation-delay: 0.3s; opacity: 0;">
                <h3 class="text-2xl font-bold text-gray-800 mb-8 flex items-center gap-3">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                    </svg>
                    Distribuci√≥n por Canal de Venta
                </h3>
                <div class="flex justify-center mb-6 sm:mb-8">
                    <div class="w-full max-w-md h-64 sm:h-80">
                        <canvas id="chartCanales"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6">
                    <div class="text-center p-4 sm:p-6 bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl hover:scale-105 transition-transform duration-300 shadow-lg">
                        <div class="flex items-center justify-center gap-2 mb-3">
                            <div class="w-4 h-4 rounded-full bg-purple-600 animate-pulse"></div>
                            <p class="text-sm font-bold text-gray-700 uppercase tracking-wide">OLO</p>
                        </div>
                        <p class="text-3xl sm:text-4xl font-black text-purple-700" id="pctOlo">0%</p>
                        <p class="text-sm text-gray-600 mt-2" id="montoOlo">‚Ç°0</p>
                    </div>
                    <div class="text-center p-4 sm:p-6 bg-gradient-to-br from-cyan-50 to-cyan-100 rounded-xl hover:scale-105 transition-transform duration-300 shadow-lg">
                        <div class="flex items-center justify-center gap-2 mb-3">
                            <div class="w-4 h-4 rounded-full bg-cyan-500 animate-pulse"></div>
                            <p class="text-sm font-bold text-gray-700 uppercase tracking-wide">UberEats</p>
                        </div>
                        <p class="text-3xl sm:text-4xl font-black text-cyan-600" id="pctUber">0%</p>
                        <p class="text-sm text-gray-600 mt-2" id="montoUber">‚Ç°0</p>
                    </div>
                    <div class="text-center p-4 sm:p-6 bg-gradient-to-br from-amber-50 to-amber-100 rounded-xl hover:scale-105 transition-transform duration-300 shadow-lg">
                        <div class="flex items-center justify-center gap-2 mb-3">
                            <div class="w-4 h-4 rounded-full bg-amber-500 animate-pulse"></div>
                            <p class="text-sm font-bold text-gray-700 uppercase tracking-wide">PedidosYA</p>
                        </div>
                        <p class="text-3xl sm:text-4xl font-black text-amber-600" id="pctPeya">0%</p>
                        <p class="text-sm text-gray-600 mt-2" id="montoPeya">‚Ç°0</p>
                    </div>
                </div>
            </div>

            <!-- Gr√°fico de Ventas √öltimos 7 D√≠as -->
            <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 animate-slide-bottom" style="animation-delay: 0.4s; opacity: 0;">
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800 mb-6 sm:mb-8 flex items-center gap-3">
                    <svg class="w-6 h-6 sm:w-8 sm:h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                    </svg>
                    Ventas √öltimos 7 D√≠as
                </h3>
                <div class="h-64 sm:h-80">
                    <canvas id="chartVentas"></canvas>
                </div>
            </div>

            <!-- Tabla de Tiendas -->
            <div class="bg-white p-8 rounded-2xl shadow-2xl border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 animate-slide-bottom" style="animation-delay: 0.5s; opacity: 0;">
                <h3 class="text-2xl font-bold text-gray-800 mb-8 flex items-center gap-3">
                    <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                    </svg>
                    Detalle por Tienda
                </h3>

                <div class="overflow-x-auto">
                    <table class="min-w-full text-center text-sm font-medium text-gray-700">
                        <thead class="bg-gradient-to-r from-purple-600 to-purple-700 text-white text-xs uppercase tracking-wider">
                            <tr>
                                <th class="px-6 py-4">Tienda</th>
                                <th class="px-6 py-4">Ventas Netas</th>
                                <th class="px-6 py-4">OLO</th>
                                <th class="px-6 py-4">Uber</th>
                                <th class="px-6 py-4">PedidosYa</th>
                                <th class="px-6 py-4">Didi</th>
                            </tr>
                        </thead>
                        <tbody id="tablaTiendas" class="divide-y divide-gray-200">
                            <tr>
                                <td colspan="6" class="px-6 py-8 text-gray-400">Cargando datos...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // IMPORTANTE: Reemplaza esta URL con la de tu Apps Script desplegado
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwmynrtl02KkeZt1HnKqN58w2FZVFtBaGXaOIVl7d3UusdzUuqjMQbMpOJCkZZzXlbc/exec';
        
        let chartCanalesInstance = null;
        let chartVentasInstance = null;

        function updateCanalesChart(dataArray) {
            if (chartCanalesInstance) {
                chartCanalesInstance.data.datasets[0].data = dataArray;
                chartCanalesInstance.update();
            }
        }

        async function fetchUltimos7Dias() {
            const day = Number(document.getElementById("inputDay").value);
            const monthSelect = document.getElementById("inputMonth");
            const monthIndex = monthSelect.selectedIndex + 1;
            const year = Number(document.getElementById("inputYear").value);

            console.log('üìÖ Calculando √∫ltimos 7 d√≠as desde:', { day, month: monthIndex, year });

            try {
                const labels = [];
                const ventasData = [];

                for (let i = 6; i >= 0; i--) {
                    const fecha = new Date(year, monthIndex - 1, day - i);
                    const diaCalc = fecha.getDate();
                    const mesCalc = fecha.getMonth() + 1;
                    const yearCalc = fecha.getFullYear();

                    const res = await fetch(`${APPS_SCRIPT_URL}?day=${diaCalc}&month=${mesCalc}&year=${yearCalc}`);
                    const data = await res.json();

                    const diasSemana = ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'];
                    labels.push(`${diasSemana[fecha.getDay()]} ${diaCalc}/${mesCalc}`);

                    if (data && data.length > 0 && !data.error) {
                        ventasData.push(data[0].ventasNetas || 0);
                    } else {
                        ventasData.push(0);
                    }
                }

                if (chartVentasInstance) {
                    chartVentasInstance.data.labels = labels;
                    chartVentasInstance.data.datasets[0].data = ventasData;
                    chartVentasInstance.update();
                }

                console.log('üìä Datos √∫ltimos 7 d√≠as:', { labels, ventasData });

            } catch (error) {
                console.error("‚ùå Error cargando √∫ltimos 7 d√≠as:", error);
            }
        }

        async function fetchVentasOakberry() {
            const day = document.getElementById("inputDay").value;
            const monthSelect = document.getElementById("inputMonth");
            const monthIndex = monthSelect.selectedIndex + 1;
            const year = document.getElementById("inputYear").value;

            console.log('üîç Fetching datos para:', { day, month: monthIndex, year });

            try {
                const res = await fetch(`${APPS_SCRIPT_URL}?day=${day}&month=${monthIndex}&year=${year}`, {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                console.log('‚úÖ Response status:', res.status);
                const data = await res.json();
                console.log('üìä Datos recibidos:', data);

                if (!data || data.length === 0) {
                    console.warn('‚ö†Ô∏è No se encontraron datos');
                    alert('No hay datos disponibles para la fecha seleccionada');
                    return;
                }

                if (data.error) {
                    console.error('‚ùå Error del servidor:', data.error);
                    alert('Error: ' + data.error + '\n' + (data.message || ''));
                    return;
                }

                // CALCULAR EL TOTAL MANUALMENTE sumando todas las tiendas (excepto si ya existe una fila "Total")
                let totalVentas = 0;
                let totalOlo = 0;
                let totalUber = 0;
                let totalPeya = 0;
                let totalDidi = 0;
                let numTiendas = 0;
                
                // Buscar si existe una fila "Total"
                let totalRowExists = false;
                for (let i = 0; i < data.length; i++) {
                    if (data[i].tienda === "Total") {
                        totalVentas = parseFloat(data[i].ventasNetas) || 0;
                        totalOlo = parseFloat(data[i].olo) || 0;
                        totalUber = parseFloat(data[i].uber) || 0;
                        totalPeya = parseFloat(data[i].peya) || 0;
                        totalDidi = parseFloat(data[i].didi) || 0;
                        totalRowExists = true;
                        console.log('‚úÖ Encontrada fila Total del servidor:', data[i]);
                        break;
                    }
                }
                
                // Si no existe fila Total, calcularla sumando todas las tiendas
                if (!totalRowExists) {
                    console.warn('‚ö†Ô∏è No existe fila Total, calculando manualmente');
                    data.forEach(row => {
                        if (row.tienda && row.tienda !== "Total") {
                            totalVentas += parseFloat(row.ventasNetas) || 0;
                            totalOlo += parseFloat(row.olo) || 0;
                            totalUber += parseFloat(row.uber) || 0;
                            totalPeya += parseFloat(row.peya) || 0;
                            totalDidi += parseFloat(row.didi) || 0;
                            numTiendas++;
                        }
                    });
                } else {
                    // Contar tiendas (excluyendo Total)
                    numTiendas = data.filter(row => row.tienda !== "Total").length;
                }

                console.log('üí∞ TOTALES FINALES:', { totalVentas, totalOlo, totalUber, totalPeya, totalDidi, numTiendas });
                console.log('üìã Todas las filas recibidas:', data);

                document.getElementById('totalVentas').textContent = `‚Ç°${Math.round(totalVentas).toLocaleString('es-CR')}`;
                document.getElementById('numTiendas').textContent = numTiendas;

                const totalCanales = totalOlo + totalUber + totalPeya + totalDidi;
                
                if (totalCanales > 0) {
                    const oloPercent = ((totalOlo / totalCanales) * 100).toFixed(1);
                    const uberPercent = ((totalUber / totalCanales) * 100).toFixed(1);
                    const peyaPercent = ((totalPeya / totalCanales) * 100).toFixed(1);
                    
                    document.getElementById('pctOlo').textContent = `${oloPercent}%`;
                    document.getElementById('pctUber').textContent = `${uberPercent}%`;
                    document.getElementById('pctPeya').textContent = `${peyaPercent}%`;
                    
                    document.getElementById('montoOlo').textContent = `‚Ç°${Math.round(totalOlo).toLocaleString('es-CR')}`;
                    document.getElementById('montoUber').textContent = `‚Ç°${Math.round(totalUber).toLocaleString('es-CR')}`;
                    document.getElementById('montoPeya').textContent = `‚Ç°${Math.round(totalPeya).toLocaleString('es-CR')}`;
                    
                    updateCanalesChart([parseFloat(oloPercent), parseFloat(uberPercent), parseFloat(peyaPercent)]);
                } else {
                    document.getElementById('pctOlo').textContent = '0%';
                    document.getElementById('pctUber').textContent = '0%';
                    document.getElementById('pctPeya').textContent = '0%';
                    updateCanalesChart([0, 0, 0]);
                }

                const tbody = document.getElementById('tablaTiendas');
                tbody.innerHTML = '';
                
                data.forEach(row => {
                    if (!row.tienda) return;
                    
                    const ventas = parseFloat(row.ventasNetas) || 0;
                    const olo = parseFloat(row.olo) || 0;
                    const uber = parseFloat(row.uber) || 0;
                    const peya = parseFloat(row.peya) || 0;
                    const didi = parseFloat(row.didi) || 0;
                    
                    const tr = document.createElement('tr');
                    tr.className = row.tienda === 'Total' ? 'bg-purple-50 font-bold' : 'hover:bg-gray-50 transition';
                    tr.innerHTML = `
                        <td class="px-6 py-4 font-bold text-gray-900">${row.tienda}</td>
                        <td class="px-6 py-4 text-purple-700 font-black">‚Ç°${Math.round(ventas).toLocaleString('es-CR')}</td>
                        <td class="px-6 py-4">‚Ç°${Math.round(olo).toLocaleString('es-CR')}</td>
                        <td class="px-6 py-4">‚Ç°${Math.round(uber).toLocaleString('es-CR')}</td>
                        <td class="px-6 py-4">‚Ç°${Math.round(peya).toLocaleString('es-CR')}</td>
                        <td class="px-6 py-4">‚Ç°${Math.round(didi).toLocaleString('es-CR')}</td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (error) {
                console.error("‚ùå Error cargando datos:", error);
                alert('Error al cargar los datos. Verifica:\n1. Que el Apps Script est√© desplegado\n2. Permisos de acceso p√∫blico\n3. Consola (F12) para detalles');
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const ctxCanales = document.getElementById("chartCanales");
            if (ctxCanales) {
                chartCanalesInstance = new Chart(ctxCanales.getContext("2d"), {
                    type: 'doughnut',
                    data: {
                        labels: ['OLO', 'UberEats', 'PedidosYa'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: ['#7c3aed', '#06b6d4', '#f59e0b'],
                            borderColor: '#ffffff',
                            borderWidth: 4,
                            hoverOffset: 20
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: { size: 14, weight: 'bold' },
                                    padding: 15
                                }
                            }
                        }
                    }
                });
            }

            const ctxVentas = document.getElementById('chartVentas');
            if (ctxVentas) {
                chartVentasInstance = new Chart(ctxVentas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Ventas',
                            data: [],
                            borderColor: '#7c3aed',
                            backgroundColor: 'rgba(124, 58, 237, 0.1)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#7c3aed',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 3,
                            pointHoverRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { intersect: false, mode: 'index' },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                padding: 15,
                                titleFont: { size: 16, weight: 'bold' },
                                bodyFont: { size: 14 },
                                borderColor: '#7c3aed',
                                borderWidth: 2,
                                callbacks: {
                                    label: function(context) {
                                        return 'Ventas: ‚Ç°' + context.parsed.y.toLocaleString('es-CR');
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(0, 0, 0, 0.05)' },
                                ticks: {
                                    font: { size: 12, weight: 'bold' },
                                    callback: function(value) {
                                        return '‚Ç°' + (value/1000).toFixed(0) + 'k';
                                    }
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { font: { size: 12, weight: 'bold' } }
                            }
                        }
                    }
                });
            }

            fetchVentasOakberry();
            fetchUltimos7Dias();

            document.getElementById("inputDay").addEventListener("change", () => {
                fetchVentasOakberry();
                fetchUltimos7Dias();
            });
            document.getElementById("inputMonth").addEventListener("change", () => {
                fetchVentasOakberry();
                fetchUltimos7Dias();
            });
            document.getElementById("inputYear").addEventListener("change", () => {
                fetchVentasOakberry();
                fetchUltimos7Dias();
            });
        });

        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const timeElement = document.getElementById('lastUpdate');
            if (timeElement) {
                timeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        
        updateTime();
        setInterval(updateTime, 1000);

        window.addEventListener('load', function() {
            const elements = document.querySelectorAll('.animate-slide-in, .animate-slide-bottom, .animate-fade-in');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
