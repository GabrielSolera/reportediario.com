<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Oakberry - Ventas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @keyframes slideInFromLeft {
            from { opacity: 0; transform: translateX(-50px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .animate-slide-in {
            animation: slideInFromLeft 0.6s ease-out forwards;
        }
        
        .animate-slide-bottom {
            animation: slideInFromBottom 0.6s ease-out forwards;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-lift:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(124, 58, 237, 0.3);
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        .card-glow {
            box-shadow: 0 0 30px rgba(124, 58, 237, 0.2);
        }
        
        .number-counter {
            font-variant-numeric: tabular-nums;
        }

        @media (max-width: 768px) {
            .hover-lift:hover {
                transform: translateY(-4px) scale(1.01);
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 via-white to-purple-50 min-h-screen">
    
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-700 via-purple-600 to-purple-800 text-white shadow-2xl overflow-hidden relative">
        <div class="absolute inset-0 shimmer opacity-20"></div>
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 relative z-10 animate-fade-in">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
                <div class="animate-slide-in text-center sm:text-left">
                    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black tracking-tight mb-2">OAKBERRY</h1>
                    <p class="text-purple-200 text-base sm:text-lg lg:text-xl font-light">Dashboard de Ventas · En tiempo real</p>
                </div>
                <div class="flex items-center gap-3 sm:gap-4 animate-slide-in" style="animation-delay: 0.2s; opacity: 0;">
                    <div class="bg-white/20 backdrop-blur-lg px-4 sm:px-6 py-2 sm:py-3 rounded-xl border border-white/30 hover:bg-white/30 transition-all duration-300">
                        <p class="text-xs text-purple-200 font-semibold uppercase tracking-wide">Última actualización</p>
                        <p class="text-base sm:text-lg font-bold" id="lastUpdate">Cargando...</p>
                    </div>
                    <div class="w-3 h-3 rounded-full bg-green-400 animate-pulse shadow-lg shadow-green-400/50"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
        <!-- Selector de Fecha -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl mb-6 sm:mb-8 border-2 border-purple-100 hover:border-purple-300 transition-all duration-300 animate-slide-bottom" style="animation-delay: 0.1s; opacity: 0;">
            <div class="flex items-center gap-3 mb-4 sm:mb-6">
                <svg class="w-6 h-6 sm:w-7 sm:h-7 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Seleccionar Fecha</h3>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6">
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">Día</label>
                    <input type="number" min="1" max="31" value="3" id="inputDay" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                </div>
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">Mes</label>
                    <select id="inputMonth" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                        <option>Enero</option>
                        <option>Febrero</option>
                        <option>Marzo</option>
                        <option>Abril</option>
                        <option>Mayo</option>
                        <option>Junio</option>
                        <option>Julio</option>
                        <option>Agosto</option>
                        <option>Septiembre</option>
                        <option selected>Octubre</option>
                        <option>Noviembre</option>
                        <option>Diciembre</option>
                    </select>
                </div>
                <div class="transform transition-all hover:scale-105">
                    <label class="block text-sm font-bold text-gray-600 mb-3 uppercase tracking-wide">Año</label>
                    <input type="number" value="2025" id="inputYear" class="w-full px-4 sm:px-6 py-3 sm:py-4 text-base sm:text-lg border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-4 focus:ring-purple-300 focus:border-purple-500 transition-all font-semibold">
                </div>
            </div>
        </div>

        <!-- KPIs Principales - 6 tarjetas -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
            <!-- Ventas del Día -->
            <div class="bg-gradient-to-br from-purple-600 to-purple-800 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.2s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-black" id="badgeVentasDia">105.4%</div>
                </div>
                <p class="text-purple-200 text-xs font-semibold uppercase tracking-wider mb-2">Ventas del Día</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiVentasDia">₡0</p>
                <div class="flex items-center justify-between pt-3 border-t border-white/20">
                    <span class="text-xs text-purple-200">Forecast: <span id="kpiForecastDia">₡0</span></span>
                    <div class="flex items-center gap-1 bg-white/20 px-2 py-1 rounded-lg">
                        <span class="text-xs font-bold" id="kpiDesvDia">0%</span>
                    </div>
                </div>
            </div>

            <!-- Desviación vs Forecast -->
            <div class="bg-gradient-to-br from-cyan-500 to-cyan-700 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.3s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-black" id="badgeDesvForecast">SOBRE FORECAST</div>
                </div>
                <p class="text-cyan-100 text-xs font-semibold uppercase tracking-wider mb-2">Desviación vs Forecast</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiDesvForecastPct">+0%</p>
                <div class="pt-3 border-t border-white/20">
                    <p class="text-xs text-cyan-100">Diferencia: <span class="font-bold" id="kpiDesvForecastMonto">₡0</span></p>
                </div>
            </div>

            <!-- Crecimiento Diario -->
            <div class="bg-gradient-to-br from-emerald-500 to-emerald-700 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.4s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-emerald-100 text-xs font-semibold uppercase tracking-wider mb-2">Crecimiento Diario</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiCrecDia">+0%</p>
                <div class="pt-3 border-t border-white/20">
                    <p class="text-xs text-emerald-100">vs mismo día semana anterior</p>
                </div>
            </div>

            <!-- Ventas Acumuladas -->
            <div class="bg-gradient-to-br from-purple-500 to-pink-600 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.5s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-black">MES</div>
                </div>
                <p class="text-purple-200 text-xs font-semibold uppercase tracking-wider mb-2">Ventas Acumuladas</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiVentasAcum">₡0</p>
                <div class="pt-3 border-t border-white/20">
                    <p class="text-xs text-purple-200">Forecast: <span class="font-bold" id="kpiForecastAcum">₡0</span></p>
                </div>
            </div>

            <!-- Desviación Forecast Acum -->
            <div class="bg-gradient-to-br from-amber-500 to-orange-600 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.6s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-black" id="badgeDesvAcum">SOBRE OBJETIVO</div>
                </div>
                <p class="text-amber-100 text-xs font-semibold uppercase tracking-wider mb-2">Desv. Forecast Acum.</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiDesvForecastAcumPct">+0%</p>
                <div class="pt-3 border-t border-white/20">
                    <p class="text-xs text-amber-100">Diferencia: <span class="font-bold" id="kpiDesvForecastAcumMonto">₡0</span></p>
                </div>
            </div>

            <!-- Crecimiento Acumulado -->
            <div class="bg-gradient-to-br from-indigo-500 to-indigo-700 text-white p-6 rounded-2xl shadow-2xl hover-lift animate-slide-bottom" style="animation-delay: 0.7s; opacity: 0;">
                <div class="flex items-center justify-between mb-4">
                    <div class="p-3 bg-white/20 rounded-xl backdrop-blur">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                        </svg>
                    </div>
                    <div class="bg-white/20 px-3 py-1 rounded-full text-xs font-black">MTD</div>
                </div>
                <p class="text-indigo-100 text-xs font-semibold uppercase tracking-wider mb-2">Crec. Acumulado</p>
                <p class="text-4xl font-black mb-3 number-counter" id="kpiCrecAcum">+0%</p>
                <div class="pt-3 border-t border-white/20">
                    <p class="text-xs text-indigo-100">vs mismo período mes anterior</p>
                </div>
            </div>
        </div>

        <!-- Tabla Detallada -->
        <div class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl border-2 border-purple-100 animate-slide-bottom" style="animation-delay: 0.8s; opacity: 0;">
            <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                </svg>
                Detalle Ventas Diarias & Acumuladas
            </h3>

            <div class="overflow-x-auto">
                <table class="min-w-full text-sm">
                    <thead class="bg-gradient-to-r from-purple-600 to-purple-700 text-white text-xs uppercase">
                        <tr>
                            <th class="px-4 py-3 text-left">Tienda</th>
                            <th class="px-4 py-3 text-center">Venta Día</th>
                            <th class="px-4 py-3 text-center">Forecast Día</th>
                            <th class="px-4 py-3 text-center">Desv. Forecast</th>
                            <th class="px-4 py-3 text-center">Crec. % Día</th>
                            <th class="px-4 py-3 text-center">Ventas Acum.</th>
                            <th class="px-4 py-3 text-center">Forecast Acum.</th>
                            <th class="px-4 py-3 text-center">Desv. Forecast Acum.</th>
                            <th class="px-4 py-3 text-center">Crec. Acum.</th>
                        </tr>
                    </thead>
                    <tbody id="tablaTiendas" class="divide-y divide-gray-200">
                        <tr>
                            <td colspan="9" class="px-6 py-8 text-center text-gray-400">Cargando datos...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwo_HEyr_1LKFv2WXjtSWSHY5-kqyz64BcUUXz8ODBkn-6F3kNaLr7qTbSio2JiTH8m/exec';

        async function fetchVentasOakberry() {
            const day = document.getElementById("inputDay").value;
            const monthSelect = document.getElementById("inputMonth");
            const monthIndex = monthSelect.selectedIndex + 1;
            const year = document.getElementById("inputYear").value;

            try {
                const res = await fetch(`${APPS_SCRIPT_URL}?day=${day}&month=${monthIndex}&year=${year}`);
                const data = await res.json();

                if (!data || data.length === 0 || data.error) {
                    alert('Error al cargar datos');
                    return;
                }

                const totalRow = data.find(row => row.tienda === "Total") || data[0];
                
                // Actualizar KPIs
                document.getElementById('kpiVentasDia').textContent = `₡${Math.round(totalRow.ventasNetas).toLocaleString('es-CR')}`;
                document.getElementById('kpiForecastDia').textContent = `₡${Math.round(totalRow.forecast).toLocaleString('es-CR')}`;
                document.getElementById('kpiDesvDia').textContent = `${totalRow.desvForecast > 0 ? '+' : ''}${totalRow.desvForecast.toFixed(1)}%`;
                
                document.getElementById('kpiDesvForecastPct').textContent = `${totalRow.desvForecast > 0 ? '+' : ''}${totalRow.desvForecast.toFixed(1)}%`;
                document.getElementById('kpiDesvForecastMonto').textContent = `₡${Math.round(totalRow.ventasNetas - totalRow.forecast).toLocaleString('es-CR')}`;
                
                document.getElementById('kpiCrecDia').textContent = `${totalRow.crecimientoDia > 0 ? '+' : ''}${totalRow.crecimientoDia.toFixed(1)}%`;
                
                document.getElementById('kpiVentasAcum').textContent = `₡${Math.round(totalRow.ventasAcumuladas).toLocaleString('es-CR')}`;
                document.getElementById('kpiForecastAcum').textContent = `₡${Math.round(totalRow.forecastAcumulado).toLocaleString('es-CR')}`;
                
                document.getElementById('kpiDesvForecastAcumPct').textContent = `${totalRow.desvForecastAcum > 0 ? '+' : ''}${totalRow.desvForecastAcum.toFixed(1)}%`;
                document.getElementById('kpiDesvForecastAcumMonto').textContent = `₡${Math.round(totalRow.ventasAcumuladas - totalRow.forecastAcumulado).toLocaleString('es-CR')}`;
                
                document.getElementById('kpiCrecAcum').textContent = `${totalRow.crecimientoAcum > 0 ? '+' : ''}${totalRow.crecimientoAcum.toFixed(1)}%`;

                // Actualizar badges
                const pctVsForec = ((totalRow.ventasNetas / totalRow.forecast) * 100).toFixed(1);
                document.getElementById('badgeVentasDia').textContent = `${pctVsForec}%`;
                document.getElementById('badgeDesvForecast').textContent = totalRow.desvForecast >= 0 ? 'SOBRE FORECAST' : 'BAJO FORECAST';
                document.getElementById('badgeDesvAcum').textContent = totalRow.desvForecastAcum >= 0 ? 'SOBRE OBJETIVO' : 'BAJO OBJETIVO';

                // Actualizar tabla
                const tbody = document.getElementById('tablaTiendas');
                tbody.innerHTML = '';
                
                data.forEach(row => {
                    if (!row.tienda) return;
                    
                    const tr = document.createElement('tr');
                    tr.className = 'hover:bg-gray-50 transition';
                    tr.innerHTML = `
                        <td class="px-4 py-3 font-bold text-gray-900">${row.tienda}</td>
                        <td class="px-4 py-3 text-center text-purple-700 font-bold">₡${Math.round(row.ventasNetas).toLocaleString('es-CR')}</td>
                        <td class="px-4 py-3 text-center">₡${Math.round(row.forecast).toLocaleString('es-CR')}</td>
                        <td class="px-4 py-3 text-center ${row.desvForecast >= 0 ? 'text-green-600' : 'text-red-500'} font-semibold">${row.desvForecast > 0 ? '+' : ''}${row.desvForecast.toFixed(1)}%</td>
                        <td class="px-4 py-3 text-center ${row.crecimientoDia >= 0 ? 'text-green-600' : 'text-red-500'} font-semibold">${row.crecimientoDia > 0 ? '+' : ''}${row.crecimientoDia.toFixed(1)}%</td>
                        <td class="px-4 py-3 text-center">₡${Math.round(row.ventasAcumuladas).toLocaleString('es-CR')}</td>
                        <td class="px-4 py-3 text-center">₡${Math.round(row.forecastAcumulado).toLocaleString('es-CR')}</td>
                        <td class="px-4 py-3 text-center ${row.desvForecastAcum >= 0 ? 'text-green-600' : 'text-red-500'} font-semibold">${row.desvForecastAcum > 0 ? '+' : ''}${row.desvForecastAcum.toFixed(1)}%</td>
                        <td class="px-4 py-3 text-center ${row.crecimientoAcum >= 0 ? 'text-green-600' : 'text-red-500'} font-semibold">${row.crecimientoAcum > 0 ? '+' : ''}${row.crecimientoAcum.toFixed(1)}%</td>
                    `;
                    tbody.appendChild(tr);
                });

            } catch (error) {
                console.error("Error:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            fetchVentasOakberry();
            document.getElementById("inputDay").addEventListener("change", fetchVentasOakberry);
            document.getElementById("inputMonth").addEventListener("change", fetchVentasOakberry);
            document.getElementById("inputYear").addEventListener("change", fetchVentasOakberry);
        });

        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const timeElement = document.getElementById('lastUpdate');
            if (timeElement) {
                timeElement.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
        
        updateTime();
        setInterval(updateTime, 1000);

        window.addEventListener('load', function() {
            const elements = document.querySelectorAll('.animate-slide-in, .animate-slide-bottom, .animate-fade-in');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                }, index * 100);
            });
        });
    </script>
</body>
</html>
